# io-services-app-backend

Service API for IO-app

## Architecture

The project is structured as follows:

```
azure-functions-api
|-- api
|-- src
|   |-- functions
|   |-- generated
|   |-- middlewares
|   |-- models
|   |-- utils
|   |   |-- blob-storage
|   |-- config.ts
|   |-- main.ts
|-- package.json
|-- host.json
```

- The `api` folder contains all the internal and external OpenAPI specification.
- The `src` folder contain all the implementation of the functions

### src Folder

The `src` folder contains the `main.ts` file that exports the implementation for all the functions defined in this workspace. The Azure Core Function V4 runtime is required to execute it.

#### functions Folder

Contains the implementation of the functions handlers

#### generated Folder

This folder contains the autogenerated code from type definitions in OpenApi specs located into the `api` folder. The command `yarn generate` start the generation process.

#### models Folder

Containst the file for the model layer of the function, that allows to access to databases (Redis and Cosmos for example).

#### middlewares Folder

Contains middlewares for local business logic, that in not usefull to share with other workspaces in the same monorepo but can be shared across multiple functions in the same applicative.

## ENV variables

The following table contains the required ENV variables that the applicative require

| Variable name                                               | Description                                                                       | type   | required |
| ----------------------------------------------------------- | --------------------------------------------------------------------------------- | ------ | -------- |
| APPINSIGHTS_INSTRUMENTATIONKEY                              | The Application Insights instrumentation key                                      | string | Y        |
| FETCH_TIMEOUT_MS                                            | (optional) Fetch Timeout for AbortableFetch                                       | number | D        |
| FEATURED_ITEMS_BLOB_CONNECTION_STRING                       | The Azure StorageAccount connectionString to retrieve FeaturedItems blob          | string | Y        |
| FEATURED_ITEMS_CONTAINER_NAME                               | The blob storage container to retrieve FeaturedItems blob                         | string | Y        |
| FEATURED_ITEMS_FILE_NAME                                    | The FeaturedItems Filename in blobStorage container                               | string | Y        |
| AZURE_SEARCH_ENDPOINT                                       | The Azure AI Search Endpoint                                                      | string | Y        |
| AZURE_SEARCH_INSTITUTIONS_INDEX_NAME                        | The Azure AI Search Institutions Index Name                                       | string | Y        |
| AZURE_SEARCH_SERVICES_INDEX_NAME                            | The Azure AI Search Services Index Name                                           | string | Y        |
| AZURE_SEARCH_INSTITUTIONS_SCOPE_SCORING_PROFILE(**\*1**)    | The Azure AI Search Institutions Scope Scoring Profile Name (eg BoostScope)       | string | N        |
| AZURE_SEARCH_INSTITUTIONS_SCOPE_SCORING_PARAMETERS(**\*1**) | The Azure AI Search Institutions Scope Scoring Parameters(eg boostScope-NATIONAL) | string | N        |
| AZURE_SEARCH_API_KEY                                        | The Azure AI Search ApiKey(when not provided use ManagedIdentities)               | string | N        |
| PAGINATION_DEFAULT_LIMIT                                    | The Pagination Default limit in Paginated API(default=20)                         | string | D        |
| PAGINATION_MAX_LIMIT                                        | The Pagination MAX limit in Paginated API (default=101)                           | string | D        |
| PAGINATION_MAX_OFFSET                                       | The Pagination MAX offset in Paginated API (default=101)                          | string | D        |

(**\*1**) To Enable Boosting in institutions search both variable **_AZURE_SEARCH_INSTITUTIONS_SCOPE_SCORING_PROFILE_** and **_AZURE_SEARCH_INSTITUTIONS_SCOPE_SCORING_PARAMETERS_** must be configured

## Local Execution

To execute locally the function copy the configuration from the `local.settings.json.example` file with:

```bash
cp local.settings.json.example local.settings.json
```

Then Fill the `local.settings.json` file.

Then you can start the function using the following command:

```bash
yarn start
```
