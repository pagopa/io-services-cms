ServiceLifecycle:
  description: Service Lifecycle model data
  allOf:
    - type: object
      properties:
        id:
          type: string
        status:
          $ref: "#/ServiceLifecycleStatus"
        version:
          type: integer
        last_update:
          $ref: "#/Timestamp"
      required:
        - id
        - status
        - last_update
    - $ref: "#/ServiceData"
ServicePublication:
  description: Service Publication model data
  allOf:
    - type: object
      properties:
        id:
          type: string
        status:
          $ref: "#/ServicePublicationStatusType"
        version:
          type: integer
        last_update:
          $ref: "#/Timestamp"
      required:
        - id
        - status
        - last_update
    - $ref: "#/ServiceData"
ServicePayload:
  description: A payload used to create or update a service.
  allOf:
    - $ref: "#/ServiceData"
ServiceData:
  type: object
  description: Service basic data
  properties:
    name:
      type: string
      minLength: 1
    description:
      type: string
      minLength: 1
    organization:
      $ref: "#/Organization"
    require_secure_channel:
      type: boolean
    authorized_recipients:
      type: array
      items:
        $ref: "#/FiscalCode"
    authorized_cidrs:
      description: >-
        Allowed source IPs or CIDRs for this service.
        When empty, every IP address it's authorized to call the IO API on
        behalf of the service.
      type: array
      items:
        $ref: "#/Cidr"
    max_allowed_payment_amount:
      type: integer
      format: int32
      minimum: 0
      maximum: 9999999999
      default: 0
    metadata:
      $ref: "#/ServiceMetadata"
  required:
    - name
    - description
    - organization
    - metadata
ServiceMetadata:
  type: object
  description: A set of service metadata properties
  properties:
    web_url:
      type: string
      minLength: 1
    app_ios:
      type: string
      minLength: 1
    app_android:
      type: string
      minLength: 1
    tos_url:
      type: string
      minLength: 1
    privacy_url:
      type: string
      minLength: 1
    address:
      type: string
      minLength: 1
    phone:
      type: string
      minLength: 1
    email:
      type: string
      minLength: 1
    pec:
      type: string
      minLength: 1
    cta:
      type: string
      minLength: 1
    token_name:
      type: string
      minLength: 1
    support_url:
      type: string
      minLength: 1
    category:
      type: string
      enum: [SPECIAL, STANDARD]
    custom_special_flow:
      type: string
      minLength: 1
    scope:
      type: string
      enum: [NATIONAL, LOCAL]
  required:
    - scope
ServiceLifecycleStatus:
  type: object
  properties:
    value:
      $ref: "#/ServiceLifecycleStatusType"
    reason:
      description: Reason for status value
      type: string
  required:
    - value
ServiceLifecycleStatusType:
  description: |
    Service lifecycle status<br>
    - _draft_: A new draft of the service has been created, filled in completely or partially and saved by the system.
    - _submitted_: The draft has been sent for internal validation to PagoPA and the response is awaited. In this state, the service is
    immutable and is frozen in the shipped version.
    - _approved_: The service has been approved by the _PagoPA S.p.A._ internal validation process, it is correct and suitable for publication.
    - _rejected_: The service goes back to the draft but cannot be resubmitted for validation unless it is modified by the institution in
    at least one of its fields.
    - _deleted_: The service is permanently deleted from the Back-Office.
  type: string
  enum: [draft, submitted, approved, rejected, deleted]
ServicePublicationStatusType:
  description: |
    Service publication status<br>
    - _published_: The service is visible in _IO App_ to users
    - _unpublished_: The service is no longer visible in _IO App_ to users, but remains in the institution's Back-Office, which can
    later choose to publish it again.
  type: string
  enum: [published, unpublished]
ServicePagination:
  type: object
  properties:
    value:
      type: array
      items:
        $ref: "#/ServiceLifecycle"
    pagination:
      $ref: "#/PaginationResultSet"
PaginationResultSet:
  type: object
  properties:
    offset:
      type: number
      description: result set offset
    limit:
      type: number
      description: result set size
    count:
      type: number
      description: total record count
Organization:
  type: object
  properties:
    name:
      type: string
      minLength: 1
    fiscal_code:
      $ref: "#/OrganizationFiscalCode"
    department_name:
      type: string
      minLength: 1
  required:
    - name
    - fiscal_code
OrganizationFiscalCode:
  type: string
  description: Organization's fiscal code.
  pattern: "^[0-9]{11}$"
  example: 012345678901
FiscalCode:
  type: string
  description: User's fiscal code.
  pattern: "^[A-Z]{6}[0-9LMNPQRSTUV]{2}[ABCDEHLMPRST][0-9LMNPQRSTUV]{2}[A-Z][0-9LMNPQRSTUV]{3}[A-Z]$"
  example: AAAAAA00A00A000A
Logo:
  description: A base64 string representation of the logo PNG image.
  type: object
  properties:
    logo:
      type: string
      format: byte
      minLength: 1
  required:
    - logo
SubscriptionKeys:
  type: object
  properties:
    primary_key:
      type: string
    secondary_key:
      type: string
  required:
    - primary_key
    - secondary_key
SubscriptionKeyType:
  type: string
  enum: [primary, secondary]
Cidr:
  type: string
  description: Describes a single IP or a range of IPs.
  pattern: ^([0-9]{1,3}[.]){3}[0-9]{1,3}(/([0-9]|[1-2][0-9]|3[0-2]))?$
Comment:
  type: object
  properties:
    comment:
      type: string
      example: This is an explanation comment
ReviewRequest:
  type: object
  properties:
    auto_publish:
      type: boolean
      description: Flag to request an automatic service publication on service approval.
      example: true
  required:
    - auto_publish
Timestamp:
  type: string
  description: A date-time field in ISO-8601 format and UTC timezone.
  example: "2023-01-22T00:00:00.000Z"
